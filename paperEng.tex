\documentclass[11pt]{article}
\usepackage[a4paper,top=2cm,bottom=2cm,left=1.5cm,right=1.5cm]{geometry}
\usepackage{graphicx}
\usepackage[linesnumbered,ruled,noend]{algorithm2e}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amssymb}
\usepackage{fancyvrb}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{hyperref}
\usepackage{courier}
\usepackage{listings}

\newtheorem{theorem}{Theorem}[section]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\theoremstyle{corollary}
\newtheorem{corollary}{Corollary}[section]

\lstset{frame=tb,
%  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

% PDF bookmarks
\usepackage{color,hyperref}
\definecolor{darkblue}{rgb}{0.0,0.0,0.3}
\hypersetup{colorlinks,breaklinks,
    linkcolor=darkblue,urlcolor=darkblue,
    anchorcolor=darkblue,citecolor=darkblue}

\pagestyle{fancy}{ %
    \fancyhf{} % remove everything
        \renewcommand{\headrulewidth}{0pt} % remove lines as well
        \renewcommand{\footrulewidth}{0.5pt}
        \rhead{\leftmark}
        \lhead{Decentralized financial reputation with multisig for lines-of-credit}
        \rfoot{Page \thepage\ of \pageref{LastPage}}}
        
\begin{document}

  \section{Abstract}
  Reputation in centralized systems typically uses stars and review-based
  trust. These systems require extensive manual intervention and secrecy to
  avoid manipulation. In decentralized systems this luxury is not available
  as the reputation system should be autonomous and open source. Previous
  peer-to-peer reputation systems define trust abstractly and do not allow for
  financial arguments pertaining to reputation. We propose a concrete
  sybil-resilient decentralized reputation system in which direct trust is
  defined as lines-of-credit using bitcoin's 1-of-2 multisig. We introduce a new
  model for bitcoin wallets in which user coins are split among trusted friends.
  Indirect trust is subsequently defined using a transitive property. This
  enables formal game theoretic arguments pertaining to risk analysis. Using our
  reputation model, we prove that risk and max flows are equivalent and propose
  several algorithms for the redistribution of trust so that a decision can be
  made on whether an anonymous third party can be indirectly trusted. In such a
  setting, the risk incurred by making a purchase from an anonymous vendor
  remains invariant. Finally, we prove the correctness of our algorithms and
  provide optimality arguments for various norms.

  \section{Introduction}

  \section{Tags/Keywords}
      decentralized, trust, web-of-trust, bitcoin, multisig, line-of-credit, trust-as-risk, flow  

  \section{Related Work}

  \section{Key points}

  \section{Definitions}
      \begin{definition}[Direct Trust from A to B, $DTr_{A \rightarrow B}$] \ \\
         Total amount of value that exists in 1-of-A,B multisigs in the utxo, where the money is deposited by A.
      \end{definition}
      \begin{definition}[B steals $x$ from A] \ \\
         B steals value $x$ from A when B reduces the $DTr_{A \rightarrow B}$ by $x$. This makes sense when 
         $x \leq DTr_{A \rightarrow B}$.
      \end{definition}
      \begin{definition}[Honest strategy] \ \\
         A member A is said to follow the honest strategy if for any value $x$ that is stolen from her, she
         substitutes it by stealing from others that trust her value equal to
         $min(x,\sum_{B \in members}{DTr_{B \rightarrow A}})$ and she takes no other action.
      \end{definition}
      \begin{definition}[Indirect trust from A to B $Tr_{A \rightarrow B}$] \ \\
         Value that A will lose if B steals the maximum amount she can steal (all her incoming trust) and everyone
         else follows the honest strategy.
      \end{definition}
  \section{Theorems-Algorithms}
    \begin{theorem}[Saturation theorem] \ \\ 
    \label{saturation}
       Let $s$ source, $x_i, i \in \{1,...,|N(s)|\}$, flows to $s$'s neighbours as calculated by the maxFlow algorithm,
       $u_i'$ new direct trusts to the $|N(s)|$ neighbours and $x_i'$ new flows to the neighbours as calculated by the
       maxFlow algorithm with the new direct trusts, $u_i'$. It holds that $\forall i \in \{1,...,|N(s)|\},
       u_i' \leq x_i \Rightarrow x_i' = u_i'$.
    \end{theorem}
    \begin{proof} \ 
       \begin{enumerate}
          \item $\forall i \in \{1,...,|N(s)|\}, x_i' > u_i'$ is impossible because a flow cannot be higher than its
                corresponding capacity. Thus $\forall i \in \{1,...,|N(s)|\}, x_i' \leq u_i'$.
          \item In the initial configuration of $u_i$ and according to the flow problem setting, a combination of flows
                $y_i$ such that $\forall i \in \{1,...,|N(s)|\}, y_i = u_i'$ is a valid, albeit not necessarily maximum,
                configuration with a flow $\sum_{i=1}^{|N(s)|}y_i$. Suppose that $\exists j \in \{1,...,|N(s)|\} : x_j'
                < u_j'$ as calculated by the maxFlow algorithm with the new direct trusts, $u_i'$. Then for the new
                maxFlow $F'$ it holds that $F' = \sum_{i=1}^{|N(s)|}x_i' < \sum_{i=1}^{|N(s)|}y_i$ since $x_j' < y_j$
                which is impossible because the configuration $\forall i \in \{1,...,|N(s)|\}, x_i' = y_i$ is valid since
                $\forall i \in \{1,...,|N(s)|\}, y_i = u_i'$ and also has a higher flow, thus the maxFlow algorithm will
                prefer the configuration with the higher flow. Thus we deduce that $\forall i \in \{1,...,|N(s)|\},
                x_i' \geq u_i'$.
       \end{enumerate}
       From (1) and (2) we conclude that $\forall i \in \{1,...,|N(s)|\}, x_i' = u_i'$.
    \end{proof}
    \begin{theorem}[Trust flow theorem] \ \\
    \label{trustflow}
       $Tr_{A \rightarrow B} = MaxFlow_{A \rightarrow B}$ (Treating trusts as capacities)
    \end{theorem}
    \begin{proof} \ 
        \begin{enumerate}
           \item $Tr_{A \rightarrow B} \geq MaxFlow_{A \rightarrow B}$ because by the definition of $Tr_{A \rightarrow B}$,
           B leaves taking with him all the incoming trust, so there is no trust flowing towards him after leaving.
           $Tr_{A \rightarrow B} < MaxFlow_{A \rightarrow B}$ would imply that after B left, there would still remain trust
           flowing from A to B.
           \item $Tr_{A \rightarrow B} \leq MaxFlow_{A \rightarrow B}$ \\
           Suppose that $Tr_{A \rightarrow B} > MaxFlow_{A \rightarrow B}$ (1). Then, using the min cut - max flow theorem we
           see that there is a set of capacities $U= \{u_1,...,u_n\}$ with flows $X = \{x_1,...,x_n\}$ such that
           $\sum_{i=1}^{n}{x_i} = MaxFlow_{A \rightarrow B}$ and, if severed $(\forall i \in \{1,...,n\} u_i' = 0)$ the flow
           from A to B would be $0$, or, put differently, there would be no directed trust path from A to B. No strategy
           followed by B could reduce the value of A, so our supposition (1) cannot be true.
        \end{enumerate}
        Combining the two results, we see that $Tr_{A \rightarrow B} = MaxFlow_{A \rightarrow B}$.
    \end{proof}

    \begin{theorem}[Honest world theorem] \ \\
    \label{honestworld}
       If everybody follows the honest strategy, nobody steals any amount from anybody.
    \end{theorem}
    \begin{proof}
       Suppose that there exists a series of stealing actions represented by a vector where $action_i = $"member $i$ steals
       value V $>0$ from member $i+1$". This vector must have an initial element, $action_1$. However, member $1$ follows
       the honest strategy, thus somebody must have stolen from her as well, so member $1$ cannot be the initial element.
       We have a contradiction, thus there cannot exist a series of stealing actions when everybody is honest.
    \end{proof}
    \begin{theorem}[Trust transfer theorem (flow terminology)] \ \\
    \label{trusttransfer}
       Let $s$ source, $t$ sink, \\
       $X_s = \{x_{s, 1}, ..., x_{s, n}\}$ outgoing flows from $s$, \\
       $X_t = \{x_{1, t}, ..., x_{m, t}\}$ incoming flows to $t$, \\
       $U_s = \{u_{s, 1}, ..., u_{s, n}\}$ outgoing capacities from $s$, \\
       $U_t = \{u_{1, t}, ..., u_{m, t}\}$ incoming capacities to $t$, \\
       $V$ the value to be transferred. \\
       Nodes apart from $s$, $t$ cannot create or consume flow. \\
       Obviously $maxFlow = F = \sum_{i=1}^{n}{x_{s, i}}$.
       {\em \begin{lstlisting}
            /                      ....                     \
           / x_s1/u_s1                         x_1t/u_1t     \
          /                                                   \
         /                                                     \
        / x_s2/u_s2                               x_2t/u_2t     \
       s-------------              ....          ------------t
        \      .                                           .    /
         \     .                                           .   /
          \    .                                           .  /
           \ x_sn/u_sn             ....        x_mt/u_mt     /
            \                                               /
       \end{lstlisting}}
       We create a new graph where
       \begin{enumerate}
         \item  $\sum_{i}{u_{s, i}'} = F - V$
         \item $\forall i \in \{1,...,n\} u_{s, i}' \leq x_{s, i}$
       \end{enumerate}
 
       It holds that $maxFlow' = F' = F - V$.
    \end{theorem}
    \begin{proof} \
       \begin{enumerate}
         \item  It is impossible to have $F' > F - V$ because $F' \leq \sum{u_{s, i}'} = F - V$.
         \item  It is impossible to have $F' < F - V$. \\
         Let $i$ be a node such that $x_{s, i} > 0$ and $I = \{(i,j) \in E\}$ the set of direct trusts outgoing from $i$.
         In the initial graph we have $x_{s, i} = \sum_{j}{x_{i, j}}, F = \sum_{i}{x_{s, i}}$
         and in the new graph we have $x_{s, i}' = u_{s, i}' \leq x_{s, i},
         F' = \sum_{i}{x_{s, i}'}, \forall j x_{i, j} \leq u_{i, j} = u_{i, j}'$.
         We can construct a set $X_i' = \{x_{i, j}'\}$ of flows such that $x_{i, j}' \leq x_{i, j}$
         and $\sum_{j}{x_{i, j}'} = x_{s, i}'$. This shows that there is a possible flow such that $F' = F - V$,
         so the maxFlow algorithm will not return a flow less than $F - V$. \\
         Example construction: \\
         $\forall j \in \{1,...,k\}, x_{i, j}' = x_{i, j}$ with $k$ such that
            \begin{enumerate}
	      \item $\sum_{j=1}^{k}{x_{i, j}} \leq x_{s, i}'$ and
	      \item $\sum_{j=1}^{k+1}{x_{i, j}} > x_{s, i}'$
            \end{enumerate}
         $x_{i, (k+1)}' = x_{s, i}' - \sum_{j=1}^{k}{x_{i, j}'}$ \\
         $\forall j \in \{k+2,...,|X_i'|\}, x_{i, j}' = 0$
       \end{enumerate}
    \end{proof}

    \begin{corollary}[Requirement for $\sum_{i}{u_{s, i}'} = F - V$, $u_{s, i}' \leq x_{s, i}$] \ \\
       In the setting of \ref{trusttransfer}, it is impossible to have $maxFlow' = F - V$ if $\sum_{i}{u_{s, i}'} > F - V
       \wedge \forall i \in \{1,...,n\},u_{s, i}' \leq x_{s, i}$.
    \end{corollary}
    \begin{proof}
       Due to \ref{trusttransfer}, $maxFlow' = F - V$ if $\sum_{i}{u_{s, i}'} = F - V
       \wedge \forall i \in \{1,...,n\}, u_{s, i}' \leq x_{s, i}$. If we create new capacities such that
       $\forall i \in \{1,...,n\}, u_{s,i}'' \leq x_{s,i}$, then obviously $maxFlow'' = \sum_{i}{u_{s,i}''}$. If
       additionally $\sum_{i}{u_{s,i}''} > F - V$, then $maxFlow'' > F - V$.
    \end{proof}

    \begin{theorem}[Trust-saving Theorem] \ \\
    \label{trustsave}
       $\forall i \in \{1,...,n\}, u_i' = F_{A_i \rightarrow B} \Leftrightarrow u_i' = u_i$
    \end{theorem}
    \begin{proof}
       We know that $x_i \leq F_{A_i \rightarrow B}$, thus we can see that any increase in $u_i'$ beyond
       $F_{A_i \rightarrow B}$ will not influence $x_i$ and subsequently will not incur any change on the rest of the flows.
    \end{proof}

    \begin{theorem}[Invariable trust reduction with naive algorithms] \ \\
    \label{invariability}
       If $\forall i \in \{1,...,n\},u_i' \leq x_i$, Trust Reduction (TrR) invariable $\: \forall \:$ configurations of $x_i$
    \end{theorem}
    \begin{proof}
       $TrR = \sum_{i=1}^{n}TrR_i$ total Trust Reduction, $TrR_i = u_i - u_i'$, Trust Reduction on i.
       Since $\forall i \in \{1,...,n\},u_i' \leq x_i$ it is $x_i' = u_i'$, thus $TrR_i = u_i - x_i'$. We know that
       $\sum_{i=1}^{n}x_i' = F - V$, so we have $TrR = \sum_{i=1}^{n}TrR_i = \sum_{i=1}^{n}(u_i - x_i') = 
       \sum_{i=1}^{n}u_i - F + V$ independent of $x_i', u_i'$
    \end{proof}

    \begin{theorem}[Dependence impossibility theorem] \ \\
    \label{independence}
       ${\partial x_j \over \partial x_i} = 0$ with $x_i$ the flow from MaxFlow $\Rightarrow
         \forall x_i' \leq x_i, {\partial x_j \over \partial x_i} = 0$ ceteris paribus
    \end{theorem}
    \begin{proof}
       TODO
    \end{proof}

    Here we show three naive algorithms for calculating new direct trusts so as to maintain invariable risk when paying
    a trusted party. \\
    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n$ flows number, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       $Fcur \gets F$ \\
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i$} 
       $i \gets 1$ \\
       \While{$Fcur > F - V$}
          {$reduce \gets min(u_i', Fcur - V)$ \\
           $Fcur \gets Fcur - reduce$ \\
           $u_i' \gets u_i' - reduce$ \\
           $i \gets i + 1$}
       \Return $U' = \bigcup_{i=1}^{n}\{u_i'\}$
       \caption{First-come, first-served trust transfer}
    \end{algorithm}

    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n$ flows number, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i$}
       $reduce \gets {V \over n}$ \\
       $reduction \gets 0$ \\
       $empty \gets 0$ \\
       $i \gets 0$ \\
       \While{$reduction < V$}
          {\If{$u_i' > 0 \: \wedge \:x_i < reduce$}
                {$empty \gets empty + 1$ \\
                 $reduce = reduce + \frac{x_i - reduce -u_i'}{n - empty}$ \\
                 $reduction \gets reduction + u_i'$ \\
                 $u_i' \gets 0$ \\}
           \ElseIf{$x_i \geq reduce$}{$reduction \gets reduction + u_i' - (x_i - reduce)$ \\
                 $u_i' \gets x_i - reduce$}
           $i \gets (i + 1) mod \:n$}
       \Return $U' = \bigcup_{i=1}^{n}\{u_i'\}$
       \caption{Absolute equality trust transfer}
    \end{algorithm}

    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n$ flows number, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i - \frac{V}{F} x_i$}
       \Return $U' = \bigcup_{i=1}^{n}\{u_i'\}$
       \caption{Proportional equality trust transfer}
    \end{algorithm}
    \begin{proof}[Proof of correctness]
       In all three algorithms, we have $u_i' <= x_i$ because in the only case where $u_i'$ is altered after its
       initialisation, it is reduced. Furthermore, a total of $V$ is subtracted from all the $u_i'$, thus
       $\sum_{i=1}^{n}u_i' = F - V$.
    \end{proof}

    However, we need to minimize $\sum_{i=1}^{n}(u_i-u_i')$.

  \section{Further Research}

  \section{References}

\end{document}
